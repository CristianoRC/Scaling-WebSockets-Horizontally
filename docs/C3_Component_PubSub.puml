@startuml C3_Component_PubSub
!include <C4/C4_Component>

title Chat API - Diagrama de Componentes (C3) - Modo PubSub


LAYOUT_LANDSCAPE()

Container(spa, "Single Page Application", "HTML, JavaScript", "Interface do usuário")

Container_Boundary(chatApi, "Chat API") {
    Component(publisher, "RedisPublisher", "Service", "Serializa mensagens e publica no canal Redis")
    Component(hub, "ChatHub", "SignalR Hub", "Recebe mensagens dos clientes via WebSocket e delega a publicação")
    Component(subscriber, "RedisSubscriber", "BackgroundService", "Assina o canal Redis e distribui mensagens recebidas para os clientes conectados")    
}

ContainerDb(redis, "Redis", "In-Memory Data Store", "Canal: chat:messages")

Rel(spa, hub, "Envia mensagem", "WebSocket")
Rel(hub, publisher, "Usa")
Rel(publisher, redis, "PUBLISH", "JSON")
Rel(redis, subscriber, "SUBSCRIBE")
Rel(subscriber, hub, "SendAsync")
Rel(hub, spa, "Recebe mensagem", "WebSocket")

SHOW_LEGEND()
@enduml
